# Cloudflare Workers Configuration for MCP Senado Federal

name = "mcp-senado"
main = "build/workers/index.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Account information (set via environment or CLI)
account_id = "205abed8e2de65cb7cc858f02be6fc15"

# Durable Objects - Persistent state across all Workers instances
[[durable_objects.bindings]]
name = "CACHE"
class_name = "CacheDurableObject"
script_name = "mcp-senado"

[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiterDurableObject"
script_name = "mcp-senado"

[[durable_objects.bindings]]
name = "CIRCUIT_BREAKER"
class_name = "CircuitBreakerDurableObject"
script_name = "mcp-senado"

[[durable_objects.bindings]]
name = "METRICS"
class_name = "MetricsDurableObject"
script_name = "mcp-senado"

# Workers KV - Static data cache (long TTL for reference data)
[[kv_namespaces]]
binding = "STATIC_CACHE_KV"
id = "dfd4c3d1755b427483a9714ddd931b37"

# Analytics Engine - Detailed metrics tracking
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# Durable Objects Migrations
[[migrations]]
tag = "v1"
new_classes = ["CacheDurableObject", "RateLimiterDurableObject", "CircuitBreakerDurableObject", "MetricsDurableObject"]

# Development environment
[env.development]
name = "mcp-senado-dev"
[env.development.vars]
ENVIRONMENT = "development"
MCP_SERVER_NAME = "mcp-senado"
MCP_SERVER_VERSION = "1.0.0"
SENADO_API_BASE_URL = "https://legis.senado.leg.br/dadosabertos"
SENADO_API_TIMEOUT = "30000"
MCP_CACHE_ENABLED = "true"
MCP_CACHE_TTL = "300000"
MCP_RATE_LIMIT_ENABLED = "true"
MCP_RATE_LIMIT_TOKENS = "30"
MCP_LOG_LEVEL = "INFO"

[[env.development.durable_objects.bindings]]
name = "CACHE"
class_name = "CacheDurableObject"
script_name = "mcp-senado"

[[env.development.durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiterDurableObject"
script_name = "mcp-senado"

[[env.development.durable_objects.bindings]]
name = "CIRCUIT_BREAKER"
class_name = "CircuitBreakerDurableObject"
script_name = "mcp-senado"

[[env.development.durable_objects.bindings]]
name = "METRICS"
class_name = "MetricsDurableObject"
script_name = "mcp-senado"

[[env.development.kv_namespaces]]
binding = "STATIC_CACHE_KV"
id = "dfd4c3d1755b427483a9714ddd931b37"

[[env.development.analytics_engine_datasets]]
binding = "ANALYTICS"

# Staging environment
[env.staging]
name = "mcp-senado-staging"
[env.staging.vars]
ENVIRONMENT = "staging"
MCP_SERVER_NAME = "mcp-senado"
MCP_SERVER_VERSION = "1.0.0"
SENADO_API_BASE_URL = "https://legis.senado.leg.br/dadosabertos"
SENADO_API_TIMEOUT = "30000"
MCP_CACHE_ENABLED = "true"
MCP_CACHE_TTL = "300000"
MCP_RATE_LIMIT_ENABLED = "true"
MCP_RATE_LIMIT_TOKENS = "30"
MCP_LOG_LEVEL = "INFO"

[[env.staging.durable_objects.bindings]]
name = "CACHE"
class_name = "CacheDurableObject"
script_name = "mcp-senado"

[[env.staging.durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiterDurableObject"
script_name = "mcp-senado"

[[env.staging.durable_objects.bindings]]
name = "CIRCUIT_BREAKER"
class_name = "CircuitBreakerDurableObject"
script_name = "mcp-senado"

[[env.staging.durable_objects.bindings]]
name = "METRICS"
class_name = "MetricsDurableObject"
script_name = "mcp-senado"

[[env.staging.kv_namespaces]]
binding = "STATIC_CACHE_KV"
id = "dfd4c3d1755b427483a9714ddd931b37"

[[env.staging.analytics_engine_datasets]]
binding = "ANALYTICS"

# Production environment
[env.production]
name = "mcp-senado-prod"
[env.production.vars]
ENVIRONMENT = "production"
MCP_SERVER_NAME = "mcp-senado"
MCP_SERVER_VERSION = "1.0.0"
SENADO_API_BASE_URL = "https://legis.senado.leg.br/dadosabertos"
SENADO_API_TIMEOUT = "30000"
MCP_CACHE_ENABLED = "true"
MCP_CACHE_TTL = "300000"
MCP_RATE_LIMIT_ENABLED = "true"
MCP_RATE_LIMIT_TOKENS = "30"
MCP_LOG_LEVEL = "INFO"
route = "mcp-senadobr.aredes.me/*"

[[env.production.durable_objects.bindings]]
name = "CACHE"
class_name = "CacheDurableObject"
script_name = "mcp-senado"

[[env.production.durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiterDurableObject"
script_name = "mcp-senado"

[[env.production.durable_objects.bindings]]
name = "CIRCUIT_BREAKER"
class_name = "CircuitBreakerDurableObject"
script_name = "mcp-senado"

[[env.production.durable_objects.bindings]]
name = "METRICS"
class_name = "MetricsDurableObject"
script_name = "mcp-senado"

[[env.production.kv_namespaces]]
binding = "STATIC_CACHE_KV"
id = "dfd4c3d1755b427483a9714ddd931b37"

[[env.production.analytics_engine_datasets]]
binding = "ANALYTICS"

# Environment variables (non-secret)
[vars]
MCP_SERVER_NAME = "mcp-senado"
MCP_SERVER_VERSION = "1.0.0"
SENADO_API_BASE_URL = "https://legis.senado.leg.br/dadosabertos"
SENADO_API_TIMEOUT = "30000"
MCP_CACHE_ENABLED = "true"
MCP_CACHE_TTL = "300000"
MCP_RATE_LIMIT_ENABLED = "true"
MCP_RATE_LIMIT_TOKENS = "30"
MCP_LOG_LEVEL = "INFO"

# Secrets (set via: wrangler secret put SECRET_NAME)
# MCP_API_KEY - Optional API key for authentication
# Run: wrangler secret put MCP_API_KEY

# Build configuration
[build]
command = "npm run build"

# Observability
[observability]
enabled = true
